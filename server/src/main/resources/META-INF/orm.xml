<?xml version="1.0" encoding="UTF-8"?>
<entity-mappings
        xmlns="http://java.sun.com/xml/ns/persistence/orm"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://java.sun.com/xml/ns/persistence/orm http://java.sun.com/xml/ns/persistence/orm_2_0.xsd"
        version="2.0">

    <named-native-query name="SchoolDataRepository.findBySearchTermNamedNativeOrmXml"
                        result-class="com.eduscape.school.SchoolDataRepository">
        <query>
            SELECT *
            FROM (
            SELECT school_number, name, average_graduation_rate, percent_rank()
            OVER ( ORDER BY average_graduation_rate DESC )
            AS 'percent_rank'
            FROM school NATURAL JOIN (
            SELECT school_number, name, AVG(graduate_count/total_enrollment) average_graduation_rate
            FROM school NATURAL JOIN school_data
            WHERE graduate_count>=0
            GROUP BY school_number
            ) SD
            ) temp
            WHERE name="BERMUDIAN SPRINGS HS"
        </query>
    </named-native-query>
</entity-mappings>